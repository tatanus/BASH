#!/usr/bin/env bash
set -uo pipefail

# Source utility functions and config files from module.sh
source "${SCRIPT_DIR}/lib/module.sh"

# Ensure required environment variables are set
validate_env_vars "TOOLS_DIR" "TEE_DIR"

# Define the input file
AQUATONE_URLS_FILE="${TOOLS_DIR}/aquatone/aquatone_urls.txt"

# Check if the input file exists
validate_file_exists "${AQUATONE_URLS_FILE}"

info "Running JexBoss on URLs from ${AQUATONE_URLS_FILE}..."
jexboss.py -D -mode file-scan -file "${AQUATONE_URLS_FILE}" | tee -a "${TEE_DIR}/JEXBOSS.tee"

if [[ $? -ne 0 ]]; then
    fail "JexBoss execution failed."
    exit 1
fi

success "JexBoss completed. Results saved to ${TEE_DIR}/JEXBOSS.tee."
