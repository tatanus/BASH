#!/usr/bin/env bash
set -uo pipefail

# Source utility functions and config files from module.sh
source "${SCRIPT_DIR}/lib/module.sh"

# Validate required environment variables
validate_env_vars DATA_DIR NMAP_DIR TOOLS_DIR

# Define the input and output files
TARGETS_FILE="${DATA_DIR}/targets.txt"

# Validate the targets file
validate_file_exists "${TARGETS_FILE}"

# Define the output directory for spoonmap results
SPOONMAP_DIR="${TOOLS_DIR}/spoonmap"

info "Running Spoonmap on targets from ${TARGETS_FILE}..."
# run spoonmap from $SPOONMAP_DIR/spoonmap.py
python3 "${SPOONMAP_DIR}/spoonmap.py"

if [[ $? -ne 0 ]]; then
    fail "Spoonmap execution failed."
    exit 1
fi

success "Spoonmap completed. Results saved to ${SPOONMAP_DIR}/spoonmap."
